!function(){function e(e){function t(e){var t,n=[];for(t=0;t<e.length;t++)n.push(e[t].slice());return n}function n(e,t,n,o){this.type=e,this.board=n,this.stone=t,o&&o.marks&&(this.marks=o.marks),this.deadBlack=o&&o.deadBlack||0,this.deadWhite=o&&o.deadWhite||0}function o(t,n,r,i){var s=t[r][n];if(0>n||0>r||n>=e||r>=e)return!1;if(s==a.None)return!0;if(n>0&&t[r][n-1]==a.None||r>0&&t[r-1][n]==a.None||e-1>n&&t[r][n+1]==a.None||e-1>r&&t[r+1][n]==a.None)return!0;if(!i){i=[];for(var c=0;e>c;++c){i[c]=[];for(var l=0;e>l;++l)i[c][l]=!1}}return i[r][n]=!0,!!(n>0&&0==i[r][n-1]&&t[r][n-1]==s&&o(t,n-1,r,i)||r>0&&0==i[r-1][n]&&t[r-1][n]==s&&o(t,n,r-1,i)||e-1>n&&0==i[r][n+1]&&t[r][n+1]==s&&o(t,n+1,r,i)||e-1>r&&0==i[r+1][n]&&t[r+1][n]==s&&o(t,n,r+1,i))}function s(t,n,o){var r=t[o][n],i=1;return 0>n||0>o||n>e-1||o>e-1||r===a.None?0:(t[o][n]=a.None,n>0&&t[o][n-1]===r&&(i+=s(t,n-1,o)),o>0&&t[o-1][n]===r&&(i+=s(t,n,o-1)),e-1>n&&t[o][n+1]===r&&(i+=s(t,n+1,o)),e-1>o&&t[o+1][n]===r&&(i+=s(t,n,o+1)),i)}for(var c,l,h=[],e=e||19,u=0;e>u;++u){h[u]=[];for(var d=0;e>d;++d)h[u][d]=a.None}c=new n(i.Root,null,h),c.turn=1,c.number=0,l=c,this.size=e,this.mode=r.PLAY_MODE,this.info={},this.setMode=function(e){this.mode=e},this.getCurrentNode=function(){return l},this.getCurrentBoard=function(){return l.board},this.getCurrentNo=function(){return l.number},this.getTurn=function(){return l.turn},this.setTurn=function(e){l.turn=e},this.shiftTurn=function(){l.turn=-turn},this.next=function(){l.next&&(l=l.next[0])},this.prev=function(){l.prev&&(l=l.prev)},this.nextMove=function(){for(var e=l.next&&l.next[0];e&&e[0].tpye!==i.Move;)e=e.next;l=e||e[0]||l},this.prevMove=function(){for(var e=l.prev;e&&e.tpye!==i.Move;)e=e.prev;l=e||l},this.first=function(){l=c},this.end=function(){for(var e=l;e.next;)e=e.next[0];l=e},this.getNextNode=function(){return l.next?l.next[0]:null},this.getPrevNode=function(){return l.prev?l.prev:null},this.getNextMove=function(){for(var e=l.next&&l.next[0];e&&e[0].type!==i.Move;)e=e.next;return e&&e[0]},this.getPrevMove=function(){for(var e=l.prev;e&&e.type!==i.Move;)e=e.prev;return e},this.getRoot=function(){return c},this.getEndNode=function(){for(var e=l;e.next;)e=e.next;return e},this.reset=function(){c.next=null,l=c},this.makeMove=function(r,c,h){var u=l.prev?l.prev.board:null,d=l.board,f=t(d);if(f[c][r]!=a.None)return-1;h?f[c][r]=h:f[c][r]=l.color===a.None?a.Black:-l.color;var v=0;if(r>0&&!o(f,r-1,c)&&f[c][r]!==f[c][r-1]&&(v+=s(f,r-1,c)),e-1>r&&!o(f,r+1,c)&&f[c][r]!==f[c][r+1]&&(v+=s(f,r+1,c)),c>0&&!o(f,r,c-1)&&f[c][r]!==f[c-1][r]&&(v+=s(f,r,c-1)),e-1>c&&!o(f,r,c+1)&&f[c][r]!==f[c+1][r]&&(v+=s(f,r,c+1)),0===v&&!o(f,r,c)||u&&f.toString()===u.toString())return-1;var g={};f[c][r]===a.Black?g.deadWhite=v:f[c][r]==a.White&&(g.deadBlack=v);var p=new n(i.Move,{x:r,y:c,color:h},f,g);return p.turn=-h,p.number=l.number+1,l.next||(l.next=[]),l.next.push(p),p.prev=l,l=p,v},this.placeStone=function(r,c,h){var u=l.board,d=t(u);if(d[c][r]!==a.None)return!1;h?d[c][r]=h:d[c][r]=l.color===a.None?a.Black:-l.color;var f=0;if(r>0&&0==o(d,r-1,c)&&d[c][r]!=d[c][r-1]&&(f+=s(d,r-1,c)),e-1>r&&0==o(d,r+1,c)&&d[c][r]!=d[c][r+1]&&(f+=s(d,r+1,c)),c>0&&0==o(d,r,c-1)&&d[c][r]!=d[c-1][r]&&(f+=s(d,r,c-1)),e-1>c&&0==o(d,r,c+1)&&d[c][r]!=d[c+1][r]&&(f+=s(d,r,c+1)),0==f&&0==o(d,r,c))return!1;var v=new n(i.Place,{x:r,y:c,color:h},d);return v.turn=l.turn,v.number=l.number,l.next||(l.next=[]),l.next.push(v),v.prev=l,l=v,!0},this.addMark=function(e,t,n){void 0!==n&&(l.marks[t][e]=n)},this.removeMark=function(e,t){l.marks[t][e]=MarkupType.None}}function t(e){this.loadSgf=function(t){var n,o,r,a,i=t,s=-1,c=!1,l="",h="";if(t)for(var u=0;u<i.length;u++)if(n=i.charAt(u),c)if("]"===n){switch(l){case"B":case"W":o=h.charCodeAt(0)-97,r=h.charCodeAt(1)-97,a="B"===l?1:-1,e.makeMove(o,r,a);break;case"DT":e.info.date=h;case"EV":e.info.event=h;case"RE":e.info.result=h;case"RU":e.info.rules=h;case"PB":e.info.playerb=h;case"BR":e.info.brank=h;case"PW":e.info.playerw=h;case"WR":e.info.wrank=h}c=!1,l=h=""}else h+=n;else switch(n){case";":l="",h="";break;case"(":l="",h="",s++;break;case")":l="",h="",s--;break;case"[":c=!0,h="";break;default:l+=n}}}function n(e,t,n){function o(e,n){var o,r,c,u=t.getCurrentBoard(),e=e||t.getRoot().board,d=t.getCurrentNode();b.save(),b.translate(.5,.5);for(var f=0;s>f;f++)for(var v=0;s>v;v++)u[f][v]!==e[f][v]&&(o=h+l*v,r=h+l*f,u[f][v]===a.None?b.clearRect(o-l/2,r-l/2,l,l):(c=u[f][v]===a.Black?"black":"white",b.fillStyle=c,b.beginPath(),b.arc(o,r,l/2-1,0,2*Math.PI),b.fill(),b.closePath()));n&&u[n.y][n.x]!==a.None&&(o=h+l*n.x,r=h+l*n.y,c=n.color===a.Black?"black":"white",b.fillStyle=c,b.lineWidth=2,b.beginPath(),b.arc(o,r,l/2-1,0,2*Math.PI),b.fill(),b.closePath()),d.type===i.Move&&(o=h+l*d.stone.x,r=h+l*d.stone.y,c=d.stone.color===a.Black?"white":"black",b.strokeStyle=c,b.lineWidth=2,b.beginPath(),b.arc(o,r,l/2/2,0,2*Math.PI),b.stroke(),b.closePath()),b.restore(),document.getElementById("zgo-moveNo").innerHTML=t.getCurrentNo()}var s=t.size,c=n,l=c/(s+1),h=l,u=document.createElement("div");u.className="zgo-main",u.style.width=n+"px";var d=document.createElement("div");d.className="zgo-canvasholder",d.style.width=n+"px",d.style.height=n+"px";var f=document.createElement("canvas");f.className="zgo-board",f.width=c,f.height=c;var v=f.getContext("2d");v.save(),v.translate(.5,.5),v.lineWidth=1;for(var g=0;s>g;g++)v.moveTo(l*g+h,h),v.lineTo(l*g+h,l*(s-1)+h),v.stroke(),v.moveTo(h,l*g+h),v.lineTo(l*(s-1)+h,l*g+h),v.stroke();s>=13&&(v.beginPath(),v.arc(h+3*l,h+3*l,2,0,2*Math.PI),v.fill(),v.closePath(),v.beginPath(),v.arc(h+3*l,c-3*l-h,2,0,2*Math.PI),v.fill(),v.closePath(),v.beginPath(),v.arc(c-3*l-h,3*l+h,2,0,2*Math.PI),v.fill(),v.closePath(),v.beginPath(),v.arc(c-3*l-h,c-3*l-h,2,0,2*Math.PI),v.fill(),v.closePath()),s>=19&&(v.beginPath(),v.arc(c/2,3*l+h,2,0,2*Math.PI),v.fill(),v.closePath(),v.beginPath(),v.arc(c/2,c-3*l-h,2,0,2*Math.PI),v.fill(),v.closePath(),v.beginPath(),v.arc(3*l+h,c/2,2,0,2*Math.PI),v.fill(),v.closePath(),v.beginPath(),v.arc(c-3*l-h,c/2,2,0,2*Math.PI),v.fill(),v.closePath(),v.beginPath(),v.arc(c/2,c/2,2,0,2*Math.PI),v.fill(),v.closePath()),v.restore();var p=document.createElement("canvas");p.className="zgo-toplayer",p.width=c,p.height=c;var b=p.getContext("2d");p.onclick=function(e){var n,a,e=e||window.event,s=t.getTurn(),c=t.mode,u=t.getCurrentNode(),d=u.type===i.Move?u.stone:null,v=f.getBoundingClientRect(),g=(e.clientX-v.left)*(f.width/v.width),p=(e.clientY-v.top)*(f.height/v.height),b=Math.round((g-h)/l),x=Math.round((p-h)/l);g=b*l+h,p=x*l+h,c===r.PLAY_MODE?n=t.makeMove(b,x,s):c===r.EDIT_MODE&&(n=t.placeStone(b,x,s)),n>=0&&(a=t.getPrevNode().board,o(a,d))},d.appendChild(f),d.appendChild(p),u.appendChild(d);var x=document.createElement("div");x.className="zgo-toolbar",x.style.width=n+"px",x.innerHTML='<span id="zgo-firstbtn" class="zgo-btn zgo-firstbtn"></span><span id="zgo-backbtn" class="zgo-btn zgo-backbtn"></span><span id="zgo-moveNo" class="zgo-moveNo">0</span><span id="zgo-nextbtn" class="zgo-btn zgo-nextbtn"></span><span id="zgo-endbtn" class="zgo-btn zgo-endbtn"></span>',x.onclick=function(e){var n,r=e.target.id,a=t.getCurrentNode(),s=t.getCurrentBoard();switch(r){case"zgo-infobtn":return void(infoDialog.style.display="block");case"zgo-firstbtn":t.first();break;case"zgo-backbtn":a.type===i.Move?(n=a.stone,t.prev()):t.prevMove();break;case"zgo-nextbtn":if(!a.next)return;if(a.type===i.Move){for(n=a.stone;t.getNextNode()&&t.getNextNode().type===i.Place;)t.next();t.getCurrentNode()===a&&t.next()}else t.next();break;case"zgo-endbtn":if(!a.next)return;a.type===i.Move&&(n=a.stone),t.end()}o(s,n)},u.appendChild(x),e.appendChild(u),this.render=o}var o="1.0",r={PLAY_MODE:0,EDIT_MODE:1},a={Black:1,None:0,White:-1},i={Root:0,Move:1,Place:2,Other:3},s=function(r){if(!r.container.nodeType||1!==r.container.nodeType)return null;this.version=o;var a=parseInt(r.width);a=!isNaN(a)&&a>0?a:520;var i=new e(19),s=new t(i),c=new n(r.container,i,a);"string"==typeof r.sgf&&(s.loadSgf(sgf),c.render())};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=s:"function"==typeof define&&define.amd&&define("zGo",[],function(){return s}),window.zGo=s}(window);